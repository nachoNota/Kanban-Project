@model tl2_proyecto_2024_nachoNota.ViewModels.UsuarioVM.CambiarContraViewModel

<div class="container-fluid">
	<div class="row">
		<!-- Aside -->
		<div class="col-md-3">
			@await Html.PartialAsync("_Aside")
		</div>

		<!-- Contenido principal -->
		<div class="col-md-9 p-5" style="max-width:30rem">
			<h2 class="">Cambiar contraseña</h2>
			<p class="text-muted mb-4">
				Para su seguridad, primero debe ingresar su contraseña actual para verificar su identidad.
				Luego, podrá establecer una nueva contraseña.
			</p>

			<div asp-validation-summary="ModelOnly" class="text-danger"></div>
			<form method="post" asp-action="CambiarContra">
				<input type="hidden" asp-for="IdUsuario">
				
				<div class="mb-4 position-relative">
					<label asp-for="PasswordActualInput" class="form-label">Contraseña actual</label>
					<div class="input-group">
						<input type="password" class="form-control" asp-for="PasswordActualInput" id="passwordActual">
						<button class="btn btn-outline-primary" type="button" id="togglePasswordActual">
							<i class="bi bi-eye" id="eyeIconActual"></i>
						</button>
					</div>
					<span asp-validation-for="PasswordActualInput" class="text-danger"></span>
				</div>

				@if (!string.IsNullOrEmpty(Model.ErrorMessage))
				{
					<p class="text-danger">@Model.ErrorMessage</p>
				}

				<div class="mb-3 position-relative">
					<label asp-for="PasswordNueva" class="form-label">Nueva contraseña</label>
					<div class="input-group">
						<input type="password" class="form-control" asp-for="PasswordNueva" id="passwordNueva">
						<button class="btn btn-outline-primary" type="button" id="togglePasswordNueva">
							<i class="bi bi-eye" id="eyeIconNueva"></i>
						</button>
					</div>
					<span asp-validation-for="PasswordNueva" class="text-danger"></span>
				</div>

				<button type="submit" class="btn btn-success mover mover-hover4 mt-3">Cambiar</button>
			</form>
		</div>
	</div>
</div>

@if (TempData["Mensaje"] != null)
{
	<div class="toast-container position-fixed top-0 end-0 p-3">
		<div class="toast show bg-success" role="alert" aria-live="assertive" aria-atomic="true">
			<div class="toast-header">
				<strong class="me-auto">Éxito</strong>
				<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
			</div>
			<div class="toast-body text-light">
				@TempData["Mensaje"]
			</div>
		</div>
	</div>
}


<script>
		document.addEventListener("DOMContentLoaded", function () {
	function togglePasswordVisibility(passwordId, iconId) {
		var passwordInput = document.getElementById(passwordId);
		var eyeIcon = document.getElementById(iconId);

		if (passwordInput.type === "password") {
			passwordInput.type = "text";
			eyeIcon.classList.remove("bi-eye");
			eyeIcon.classList.add("bi-eye-slash");
		} else {
			passwordInput.type = "password";
			eyeIcon.classList.remove("bi-eye-slash");
			eyeIcon.classList.add("bi-eye");
		}
	}

	document.getElementById("togglePasswordActual").addEventListener("click", function () {
		togglePasswordVisibility("passwordActual", "eyeIconActual");
	});

	document.getElementById("togglePasswordNueva").addEventListener("click", function () {
		togglePasswordVisibility("passwordNueva", "eyeIconNueva");
	});
});
</script>